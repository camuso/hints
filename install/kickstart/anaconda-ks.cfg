# Kickstart file automatically generated by anaconda.

#version=RHEL6
install
nfs --server=storage.bos.redhat.com --dir=/vol/engineering/devarchive/redhat/rel-eng/RHEL6.0-Snapshot-11/6/Workstation/x86_64/os
lang en_US.UTF-8
keyboard us
network --device eth0 --bootproto dhcp
rootpw  --iscrypted $6$eDW/VajjIX4HzsN8$R6f//FsXQXGrZrmLXEyFGpKe/jYzrbnLTmowUP40l.3HsOh4Fgdo0RZWuxdeRVqK/mmVcOyVo9CLdlUAB9zjE/

firewall --service=ssh
authconfig --enableshadow --passalgo=sha512 --enablefingerprint
selinux --enforcing
timezone America/New_York
bootloader --location=mbr --driveorder=sda --append="crashkernel=auto rhgb quiet"
# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work
#clearpart --linux --drives=sda

#part /boot --fstype=ext4 --size=500
#part pv.vpDtCz-CUyr-jJJn-YsH0-vn5b-hggc-wABT6h --grow --size=1
#volgroup vg_hpdl380g701 --pesize=4096 pv.vpDtCz-CUyr-jJJn-YsH0-vn5b-hggc-wABT6h
#logvol /home --fstype=ext4 --name=lv_home --vgname=vg_hpdl380g701 --grow --size=100
#logvol / --fstype=ext4 --name=lv_root --vgname=vg_hpdl380g701 --grow --size=1024 --maxsize=51200
#logvol swap --name=lv_swap --vgname=vg_hpdl380g701 --grow --size=1024 --maxsize=14080
repo --name="Red Hat Enterprise Linux"  --baseurl=file:///mnt/source/ --cost=100
repo --name="Scalable Filesystem Support"  --baseurl=file:///mnt/source/ScalableFileSystem/ --cost=1000

%pre

wget "http://lab2.rhts.eng.bos.redhat.com/cblr/svc/op/trig/mode/pre/profile/RHEL6.0-Snapshot-11_nfs-Workstation-x86_64" -O /dev/null



# Check in with Beaker Server
python << _EOF_
import xmlrpclib
server = xmlrpclib.Server("http://lab2.rhts.eng.bos.redhat.com:8000")
server.install_start("RHEL6.0-Snapshot-11_nfs-Workstation-x86_64")
_EOF_


wget -O /tmp/anamon "http://lab2.rhts.eng.bos.redhat.com/cobbler/aux/anamon"
python /tmp/anamon --name "RHEL6.0-Snapshot-11_nfs-Workstation-x86_64" --server "lab2.rhts.eng.bos.redhat.com" --port "80"


# Error: no snippet data for RedHatEnterpriseLinux6_pre

# Error: no snippet data for system_pre


%end

%post
wget "http://lab2.rhts.eng.bos.redhat.com/cblr/svc/op/yum/profile/RHEL6.0-Snapshot-11_nfs-Workstation-x86_64" --output-document=/etc/yum.repos.d/cobbler-config.repo

# End yum configuration
#

 # this no longer works with RHEL6



# Start download cobbler managed config files (if applicable)
# End download cobbler managed config files (if applicable)

# Start koan environment setup
echo "export COBBLER_SERVER=lab2.rhts.eng.bos.redhat.com" > /etc/profile.d/cobbler.sh
echo "setenv COBBLER_SERVER lab2.rhts.eng.bos.redhat.com" > /etc/profile.d/cobbler.csh
# End koan environment setup

# begin Red Hat management server registration
# not configured to register to any Red Hat management server (ok)
# end Red Hat management server registration

# Enable post-install boot notification

wget -O /usr/local/sbin/anamon "http://lab2.rhts.eng.bos.redhat.com/cobbler/aux/anamon"
wget -O /etc/rc.d/init.d/anamon "http://lab2.rhts.eng.bos.redhat.com/cobbler/aux/anamon.init"

chmod 755 /etc/rc.d/init.d/anamon /usr/local/sbin/anamon
test -d /selinux && restorecon /etc/rc.d/init.d/anamon /usr/local/sbin/anamon

chkconfig --add anamon

cat << __EOT__ > /etc/sysconfig/anamon
COBBLER_SERVER="lab2.rhts.eng.bos.redhat.com"
COBBLER_PORT="80"
COBBLER_NAME="RHEL6.0-Snapshot-11_nfs-Workstation-x86_64"
LOGFILES="/var/log/boot.log /var/log/messages /var/log/dmesg"
__EOT__



/sbin/chkconfig ntpdate on
/sbin/chkconfig ntpd on
echo 'OPTIONS="$OPTIONS -x"' >>/etc/sysconfig/ntpd





# Add Distro Repos
cat << EOF > /etc/yum.repos.d/beaker-addon-ScalableFileSystem-os.repo
[beaker-addon-ScalableFileSystem-os]
name=beaker-addon-ScalableFileSystem-os
baseurl=http://lab2.rhts.eng.bos.redhat.com/distros/vol/engineering/devarchive/redhat/rel-eng/RHEL6.0-Snapshot-11/6/Workstation/x86_64/os/ScalableFileSystem
enabled=1
gpgcheck=0
EOF
cat << EOF > /etc/yum.repos.d/beaker-debug-optional.repo
[beaker-debug-optional]
name=beaker-debug-optional
baseurl=http://lab2.rhts.eng.bos.redhat.com/distros/vol/engineering/devarchive/redhat/rel-eng/RHEL6.0-Snapshot-11/6/Workstation/x86_64/os/../../optional/x86_64/debug
enabled=1
gpgcheck=0
EOF
cat << EOF > /etc/yum.repos.d/beaker-os-optional.repo
[beaker-os-optional]
name=beaker-os-optional
baseurl=http://lab2.rhts.eng.bos.redhat.com/distros/vol/engineering/devarchive/redhat/rel-eng/RHEL6.0-Snapshot-11/6/Workstation/x86_64/os/../../optional/x86_64/os
enabled=1
gpgcheck=0
EOF
cat << EOF > /etc/yum.repos.d/beaker-debug.repo
[beaker-debug]
name=beaker-debug
baseurl=http://lab2.rhts.eng.bos.redhat.com/distros/vol/engineering/devarchive/redhat/rel-eng/RHEL6.0-Snapshot-11/6/Workstation/x86_64/os/../debug
enabled=1
gpgcheck=0
EOF
cat << EOF > /etc/yum.repos.d/beaker-os.repo
[beaker-os]
name=beaker-os
baseurl=http://lab2.rhts.eng.bos.redhat.com/distros/vol/engineering/devarchive/redhat/rel-eng/RHEL6.0-Snapshot-11/6/Workstation/x86_64/os/.
enabled=1
gpgcheck=0
EOF

# Add Harness Repos

# Add Custom Repos


# Install old rhts commands
yum -y --disablerepo=* --enablerepo=beaker-* install rhts-test-env-lab rhts-legacy
yum -y --disablerepo=* --enablerepo=beaker-* install koan
# Install new harness
yum -y --disablerepo=* --enablerepo=beaker-* install beah
# This may fail if you are outside of Red Hat..
yum -y --disablerepo=* --enablerepo=beaker-* install beakerlib-redhat
cat << EOF > /etc/beah_beaker.conf
[DEFAULT]
# LAB_CONTROLLER: URI of Beaker's XML-RPC handler
LAB_CONTROLLER=http://lab2.rhts.eng.bos.redhat.com:8000/server
# # HOSTNAME: Pretend to be machine with given name:
# #HOSTNAME=fake.hostname.com
HOSTNAME=RHEL6.0-Snapshot-11_nfs-Workstation-x86_64
EOF
# Turn on Debug logging
/bin/sed -i 's/DEVEL=False/DEVEL=True/' /etc/beah.conf
/bin/sed -i 's/INTERFACE=localhost/INTERFACE=/' /etc/beah.conf
/bin/sed -i 's/CONSOLE_LOG=.*/CONSOLE_LOG=True/' /etc/beah.conf

chkconfig --add beah-srv
chkconfig --add beah-beaker-backend
chkconfig --add beah-fwd-backend

#Add test user account
useradd --password '$6$oIW3o2Mr$XbWZKaM7nA.cQqudfDJScupXOia5h1u517t6Htx/Q/MgXm82Pc/OcytatTeI4ULNWOMJzvpCigWiL4xKP9PX4.' test
wget -O /etc/rc.d/init.d/koan "http://lab2.rhts.eng.bos.redhat.com/beaker/koan.init"

chmod 755 /etc/rc.d/init.d/koan
test -d /selinux && restorecon /etc/rc.d/init.d/koan

chkconfig --add koan



wget "http://lab2.rhts.eng.bos.redhat.com/cblr/svc/op/ks/profile/RHEL6.0-Snapshot-11_nfs-Workstation-x86_64" -O /root/cobbler.ks
wget "http://lab2.rhts.eng.bos.redhat.com/cblr/svc/op/trig/mode/post/profile/RHEL6.0-Snapshot-11_nfs-Workstation-x86_64" -O /dev/null



# Error: no snippet data for RedHatEnterpriseLinux6_post

# Error: no snippet data for system_post



%end
